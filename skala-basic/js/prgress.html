<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>부트스트랩 예제</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qQnuqkuIAvNWLzeN8tE5YBujZqJLB"
    crossorigin="anonymous"
  />
</head>

<body>
  <div
    id="progressWrap"
    class="m-3 progress"
    role="progressbar"
    aria-valuenow="0"
    aria-valuemin="0"
    aria-valuemax="100"
  >
    <div id="progressBar" class="progress-bar" style="width: 0%">0%</div>
  </div>

  <button id="startButton" type="button" class="m-3 btn btn-primary">
    시작
  </button>

  <script>
    const progressWrap = document.getElementById("progressWrap");
    const progressBar = document.getElementById("progressBar");
    const startButton = document.getElementById("startButton");

    const STEP = 10;
    const STEP_MS = 1000;
    const END_MIN_MS = 3000;
    const END_MAX_MS = 5000;

    let intervalId = null;
    let timeoutId = null;
    let percent = 0;
    let isRunning = false;

    function clamp(n, min, max) {
      return Math.max(min, Math.min(max, n));
    }

    function setProgress(nextPercent) {
      percent = clamp(nextPercent, 0, 100);
      progressBar.style.width = `${percent}%`;
      progressBar.textContent = `${percent}%`;
      progressWrap.setAttribute("aria-valuenow", String(percent));
    }

    function randomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function cleanupTimers() {
      if (intervalId !== null) {
        clearInterval(intervalId);
        intervalId = null;
      }
      if (timeoutId !== null) {
        clearTimeout(timeoutId);
        timeoutId = null;
      }
    }

    // ✔ 검증 완료 시점(프로그래스 완료)
    function finish() {
      if (!isRunning) return;

      cleanupTimers();
      setProgress(100);
      isRunning = false;
      startButton.disabled = false;

      // ✔ 입력값 검증 완료 → google.com 이동
      window.location.href = "https://www.google.com";
    }

    function startProgress() {
      if (isRunning) return;

      isRunning = true;
      startButton.disabled = true;

      cleanupTimers();
      setProgress(0);

      const endMs = randomInt(END_MIN_MS, END_MAX_MS);

      intervalId = setInterval(() => {
        setProgress(percent + STEP);
        if (percent >= 100) finish();
      }, STEP_MS);

      timeoutId = setTimeout(finish, endMs);
    }

    startButton.addEventListener("click", startProgress);
    window.addEventListener("beforeunload", cleanupTimers);
  </script>

  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
    crossorigin="anonymous"
  ></script>
</body>
</html>
